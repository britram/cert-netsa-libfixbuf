
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>fixbuf- Documentation</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <link rel="stylesheet" type="text/css" href="../../site/style.css" />
        <link rel="stylesheet" type="text/css" href="doxygen.css">
        <link rel="stylesheet" type="text/css" href="tabs.css">
</head>
<body>
    <div id="p-body">
      <div id="l-header">
        <img src="../../site/sei-logo.png" id="l-sei-logo"
            alt="Software Engineering Institute | Carnegie Mellon&copy;" />
        <div id="l-netsa-logo"><a id="l-netsa-name" href="../../index.html"><b>CERT NetSA Security Suite</b></a></div>
        <div id="l-netsa-motto">Monitoring for Large-Scale Networks</div>
        <h1 class="l-page-title">fixbuf</h1>
        <span id="l-subtitle">Documentation</span>
      </div><!-- l-header -->
      <div id="l-content">
        <div id="l-sidebar">
          <div class="p-sidebar-section">
            <h1><a href="../index.html">fixbuf</a></h1>
            <ul>
              <li><a href="index.html">Documentation</a></li>
              <li><a href="../download.html">Downloads</a></li>
	      <li><a href="../../pyfixbuf/index.html">pyfixbuf</a></li>
            </ul>
          </div><!-- p-sidebar-section -->
        </div><!-- l-sidebar -->
      <div id="top"> <!-- need this for doxygen -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Network Collectors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Listening over the Network - TCP Recommended:</p>
<p>An additional type, <a class="el" href="public_8h.html#a4265eb950b491c405d075f1510a5710e">fbListener_t</a>, is used to build Collecting Processes to listen for connections from IPFIX Exporting Processes via the network. To use a listener, first create an fbInfoModel_t using <a class="el" href="public_8h.html#a390f707c7decf65060f31c0dba6c2a97" title="Allocate a new information model. ">fbInfoModelAlloc()</a> and any additional, vendor-specific information elements using <a class="el" href="public_8h.html#ae06a524366afa6827d7e5abb1c33c0d0" title="Add a single information element to an information model. ">fbInfoModelAddElement()</a>, <a class="el" href="public_8h.html#a202bfa2340263229893a38de18670179" title="Add multiple information elements in an array to an information model. ">fbInfoModelAddElementArray()</a>, <a class="el" href="public_8h.html#aad00d1ffb4ef338bba8ac31e0c109f51" title="Add information specified in the given XML file to the information model. ">fbInfoModelReadXMLFile()</a>, or <a class="el" href="public_8h.html#a3d3efcc1c075736f9c0c0425cf0aa8c2" title="Add information specified in the given XML data to the information model. ">fbInfoModelReadXMLData()</a>. Next create an fbSession_t using <a class="el" href="public_8h.html#ace1d8a4523d098e625d5330e0d15bd4b" title="Allocate a transport session state container. ">fbSessionAlloc()</a> and add internal templates via <a class="el" href="public_8h.html#a2e4baf6d2142eca4cb526b1e80628bf8" title="Add a template to a session. ">fbSessionAddTemplate()</a>. Instead of maintaining state for a particular Transport Session, this fbSession_t instance will be used as a template for each Transport Session created by the listener.</p>
<p>Then create an fbListener_t to encapsulate a passive socket on the network to wait for connections from Exporting Processes using the <a class="el" href="public_8h.html#a68a2e34a62fbfe7fe37dffa8b6b05048" title="Allocate a listener. ">fbListenerAlloc()</a> call.</p>
<p>To wait for a connection from an Exporting Process, call <a class="el" href="public_8h.html#a514187cc62c75d4ed92ae2e497d21a42" title="Wait on a listener. ">fbListenerWait()</a>, which handles the cloning of the fbSession_t, the creation of the fbCollector_t, and the creation of the buffer for reading from that collector, and returns the newly created fBuf_t instance.</p>
<p>A listener binds to each address returned by getaddrinfo(). Once a packet has been received, the collector will only read packets on the address it received the first packet UNLESS <a class="el" href="public_8h.html#a514187cc62c75d4ed92ae2e497d21a42" title="Wait on a listener. ">fbListenerWait()</a> is called again. If the application is expecting multiple connections or IPFIX records from multiple IPFIX (UDP) exporters, then the application should put the fBuf_t returned from <a class="el" href="public_8h.html#a514187cc62c75d4ed92ae2e497d21a42" title="Wait on a listener. ">fbListenerWait()</a> into to manual mode by calling <a class="el" href="public_8h.html#a661f4cc21e726345d3e22372af33c2d1" title="Set the automatic mode flag on a buffer. ">fBufSetAutomaticMode()</a> with FALSE as the second argument and handle FB_ERROR_EOM errors returned from <a class="el" href="public_8h.html#a11c40f1d55e2d4b29b40eb4c07ce5ee7" title="Retrieve a record from a buffer. ">fBufNext()</a> by calling <a class="el" href="public_8h.html#a514187cc62c75d4ed92ae2e497d21a42" title="Wait on a listener. ">fbListenerWait()</a> again.</p>
<p>Each listener tracks every active collector/buffer (i.e., each active Session) it created; the <a class="el" href="public_8h.html#a514187cc62c75d4ed92ae2e497d21a42" title="Wait on a listener. ">fbListenerWait()</a> call will return an fBuf_t from which another IPFIX Message may be read if no new connections are available. The preferred parameter may be used to request an fBuf_t to try first, to minimize switching among available Sessions. See the documentation for <a class="el" href="public_8h.html#a514187cc62c75d4ed92ae2e497d21a42" title="Wait on a listener. ">fbListenerWait()</a> for more details.</p>
<p>If an application wants to wait for connections on multiple ports or multiple transport protocols, the application can use <a class="el" href="public_8h.html#a10d092063e0986f7fab4444fa0f65822" title="Similar to fbListenerWait(), except that is looks for connections for multiple listeners. ">fbListenerGroupWait()</a> to accept multiple connections. The application should create separate sessions and fbConnSpec_ts for each fbListener and call <a class="el" href="public_8h.html#a68a2e34a62fbfe7fe37dffa8b6b05048" title="Allocate a listener. ">fbListenerAlloc()</a> to allocate each listener. Create an fbListenerGroup_t by calling <a class="el" href="public_8h.html#a68c450b3579f5a1fa3c862a647eaa704" title="Allocates and returns a fbListenerGroup with no entries. ">fbListenerGroupAlloc()</a> and add each listener to the group using <a class="el" href="public_8h.html#a5b5716c8fe63a2f982e32a98eed0e38f" title="Adds a previously allocated listener to the previously allocated group. ">fbListenerGroupAddListener()</a>. Instead of calling <a class="el" href="public_8h.html#a514187cc62c75d4ed92ae2e497d21a42" title="Wait on a listener. ">fbListenerWait()</a>, use the function <a class="el" href="public_8h.html#a10d092063e0986f7fab4444fa0f65822" title="Similar to fbListenerWait(), except that is looks for connections for multiple listeners. ">fbListenerGroupWait()</a> to listen on all addresses in the group. <a class="el" href="public_8h.html#a10d092063e0986f7fab4444fa0f65822" title="Similar to fbListenerWait(), except that is looks for connections for multiple listeners. ">fbListenerGroupWait()</a> returns an fbListenerGroupResult_t which is a linked list of results. The fbListenerGroupResult_t contains a pointer to an fBuf_t and the fbListener_t that created the fBuf_t as well as a pointer to the next result, if available. Use <a class="el" href="public_8h.html#a620984c30070a7b3a1da81d1f84d798d" title="Free the fbListenerGroupResult_t returned from fbListenerGroupWait() ">fbListenerFreeGroupResult()</a> to free the result when <a class="el" href="public_8h.html#a11c40f1d55e2d4b29b40eb4c07ce5ee7" title="Retrieve a record from a buffer. ">fBufNext()</a> has been called on each fBuf_t.</p>
<p>The application could also use <a class="el" href="public_8h.html#a0d0fd5679efb1df055c72cfc10189363" title="Waits for an incoming connection, just like fbListenerWait(), except that this function doesn&#39;t monit...">fbListenerWaitNoCollectors()</a> to handle only the initial accepting of a connection (for TCP). Once the application returns to <a class="el" href="public_8h.html#a0d0fd5679efb1df055c72cfc10189363" title="Waits for an incoming connection, just like fbListenerWait(), except that this function doesn&#39;t monit...">fbListenerWaitNoCollectors()</a>, fixbuf will ignore that socket descriptor for the length of the connection.</p>
<p>Additionally, the application can use <a class="el" href="public_8h.html#abc226a9f5cef7f773fe55817839179d0" title="Returns an fBuf wrapped around an independently managed socket and a properly created listener for TC...">fbListenerOwnSocketCollectorTCP()</a> to provide its own socket for listening instead of libfixbuf creating one for it.</p>
<p>To reject incoming connections, the application should use the <a class="el" href="public_8h.html#a4313f40737bf2a6ab1db94693119312c">fbListenerAppInit_fn</a> function callback. This will be called right after accept() is called (in the TCP case). The application can veto the connection by returning FALSE. Once the connection is vetoed, fixbuf will not listen on that socket descriptor. If the appinit() function should reject a connection the application should set the error code to FB_ERROR_NLREAD and the application should ignore FB_ERROR_NLREAD error codes. The appinit() function works slightly different for UDP. See the <a class="el" href="udp.html">UDP instructions</a> for how to use appinit() for collecting IPFIX over UDP. </p>
</div></div><!-- contents -->
      </div><!-- l-content -->
      <div id="l-footer">&copy; 2006-2018 Carnegie Mellon University</div>
    </div><!-- p-body -->
</body>
</html>
